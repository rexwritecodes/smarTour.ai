<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>smarTour - AI Travel Guide</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="icon" type="image/png" href="/frontend/airplane.png">
</head>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="styles.css" />
<link rel="manifest" href="manifest.json" />
<script src="script.js"></script>
<script src="ai.js"></script>

<style>


</style>
</head>

<body>
  <header>
    <img src="/frontend/airplane.png" style="width: 4%;" alt="">
    <div id="logo1" class="logo">smarTour</div>
    <nav>
      <ul class="nav-links">
        <li><a href="#">Home</a></li>
        <li><a href="#AI">Destinations</a></li>
        <li><a href="#">Tours</a></li>
        <li><a href="#blog">Blog</a></li>
      </ul>
    </nav>
    <button class="cta-button" onclick="openLoginModal()">Sign In</button>
    <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
  </header>
  <div class="hero">
    <h1>Dream, Explore, Discover</h1>
    <section>
      <div class="gallery-container">
        <h2>Popular Destinations</h2>
        <h2>Travel Gallery</h2>
        <div class="gallery">
          <img src="/res/goa.jpeg" alt="Beautiful Beach" onclick="openLightbox(this)" />
          <img src="/res/hardergrat-trail-04294.webp" alt="Mountain View" onclick="openLightbox(this)" />
          <img src="/res/Kinkakuji-Temple.jpg" alt="Historical Site" onclick="openLightbox(this)" />
          <img src="/res/manali.jpeg" alt="City Skyline" onclick="openLightbox(this)" />
          <img src="/res/Sensoji Temple.avif" alt="Desert Adventure" onclick="openLightbox(this)" />
          <img src="/res/antarctica.avif" alt="Forest Hiking" onclick="openLightbox(this)" />
        </div>
      </div>
    </section>

    <div class="testimonials">
      <div id="AI" class="testimonial active">
        <p>
          "Great travel experience! The AI guide helped me explore hidden gems
          I wouldn‚Äôt have found otherwise."
        </p>
      </div>
      <div class="testimonial">
        <p>
          "Loved the destinations! The recommendations were spot on, and the
          booking process was seamless."
        </p>
      </div>
      <div class="testimonial">
        <p>
          "Affordable packages and amazing guides! This platform made my dream
          vacation possible within budget."
        </p>
      </div>
      <div class="testimonial">
        <p>
          "I never imagined AI could enhance my travel experience so much! The
          smart suggestions were incredible."
        </p>
      </div>
      <div class="testimonial">
        <p>
          "Highly recommend smarTour! The local insights and real-time updates
          made my trip stress-free."
        </p>
      </div>
    </div>
    <section class="search-section">
      <h2 class="blog-title">Get attractions by city name</h2>
      <p>Your AI-powered travel companion for the best experiences.</p>
      <div class="search-bar">
        <form autocomplete="off" onsubmit="return false;">
          <input
            type="search" 
            id="searchInput"
            name="no_autofill_location"
            placeholder="Enter a location..."
            autocomplete="new-password"
            autocorrect="off"
            spellcheck="false"
          />
        </form>
        <button id="search" onclick="searchPlace()">Search</button>
      </div>
      <div class="places-container">
        <div id="places-list" class="places-grid"></div>
      </div>
    
    
      <div id="map"></div>
    </section>
    
  </div>

  <section class="search-section">
    <div id="ai-tour" class="ai-tour-container">
      <h2>AI-Powered Travel Guide</h2>
      <h2>Discover the world with personalized recommendations.</h2>
      <section id="ai">
        <section>
          <p style="font-size: 2rem; font-weight: bold;">Get Ai Suggested Tours</p>
        </section>
        <div class="chat-container">
          <form autocomplete="off" onsubmit="return false;">
          <input type="text" id="user-input" placeholder="Enter Place" />
          <input type="text" id="days" placeholder="Enter Days" />
          <input type="text" id="budget" placeholder="Enter Budget" />
          <input type="text" id="type" placeholder="Solo or Family" />
          <button id="send-btn">Search</button>
          <div id="chat-box"></div>
        </form>
        </div>
      </section>
      <button class="cta-button">Get Started</button>

    </div>
  </section>
  <section id="blog">
    <h2 class="blog-title">Latest Blog Posts</h2>
    <div class="blog-container">
      <div class="blog-card" onclick="openBlog(0)">
        <img src="/res/hidden.avif" alt="Blog Image 1">
        <div class="blog-content">
          <h3>Exploring Hidden Gems</h3>
          <p>Discover underrated travel destinations for your next adventure...</p>
          <button class="read-more">Read More</button>
        </div>
      </div>

      <div class="blog-card" onclick="openBlog(1)">
        <img src="/res/budget.avif" alt="Blog Image 2">
        <div class="blog-content">
          <h3>How to Travel on a Budget</h3>
          <p>Save money while traveling with these smart tips...</p>
          <button class="read-more">Read More</button>
        </div>
      </div>

      <div class="blog-card" onclick="openBlog(2)">
        <img src="/res/localfood.avif" alt="Blog Image 3">
        <div class="blog-content">
          <h3>Must-Try Local Cuisines</h3>
          <p>Explore the best dishes from different cultures...</p>
          <button class="read-more">Read More</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Blog Popup Modal -->
  <div id="blogModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeBlog()">&times;</span>
      <h2 id="modalTitle"></h2>
      <img id="modalImage" src="" alt="Blog Image">
      <p id="modalContent"></p>
    </div>
  </div>


  <div class="ai-chat-widget">
    <div class="chat-header">
      <span>AI Travel Chatbot</span>
      <button onclick="toggleDiv()" class="minimize-btn">+</button>
    </div>
  
    <div id="chat1" style="display: none;" class="chat-messages"></div>
  
    <div class="chat-input" style="display: none;" id="chat2">
      <!-- Wrapped inside a form to control autocomplete -->
      <form autocomplete="off" onsubmit="return false;">
        <input
        id="userQuery"
          type="search"  
          id="userQuery"
          name="no_autofill_chatbox"
          placeholder="Ask me about travel..."
          autocomplete="new-password"
          autocorrect="off"
          spellcheck="false"
        />
      </form>
    </div>
  </div>
  

   

      <button onclick="handleAskAI()">Send</button>
    </div>
  </div>


  <footer>smarTour.</footer>

  <script>
    function openLoginModal() {
      document.getElementById("loginModal").style.display = "flex";
    }

    function closeLoginModal() {
      document.getElementById("loginModal").style.display = "none";
    }

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (username === "admin" && password === "1234") {
        alert("Login successful!");
        closeLoginModal();
        // Optionally show/hide features after login
        document.querySelector(".cta-button").innerText = "Logout";
        document.querySelector(".cta-button").onclick = logout;
      } else {
        alert("Invalid credentials.");
      }
    }
    
    function logout() {
      alert("Logged out.");
      document.querySelector(".cta-button").innerText = "Sign In";
      document.querySelector(".cta-button").onclick = openLoginModal;
    }
    function openLoginModal() {
      document.getElementById("loginModal").style.display = "flex";
      document.getElementById("registerModal").style.display = "none";

    }

    function closeLoginModal() {
      document.getElementById("loginModal").style.display = "none";
    }

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (username === "admin" && password === "1234") {
        alert("Login successful!");
        closeLoginModal();
        // Optionally show/hide features after login
        document.querySelector(".cta-button").innerText = "Logout";
        document.querySelector(".cta-button").onclick = logout;
      } else {
        alert("Invalid credentials.");
      }
    }

    function logout() {
      alert("Logged out.");
      document.querySelector(".cta-button").innerText = "Sign In";
      document.querySelector(".cta-button").onclick = openLoginModal;
    }


    function toggleDiv() {
      let div = document.getElementById("chat1");
      if (div.style.display === "none") {
        div.style.display = "block"; // Show div
      } else {
        div.style.display = "none"; // Hide div
      }
      let div2 = document.getElementById("chat2");
      if (div2.style.display === "none") {
        div2.style.display = "block"; // Show div
      } else {
        div2.style.display = "none"; // Hide div
      }
    }


    var map = L.map("map").setView([19.076, 72.8777], 10);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    function addMarker(lat, lon, place) {
      L.marker([lat, lon])
        .addTo(map)
        .bindPopup(`<b>${place}</b>`)
        .openPopup();
      map.setView([lat, lon], 12);
    }
    let currentTestimonial = 0;
    const testimonials = document.querySelectorAll(".testimonial");

    function rotateTestimonials() {
      testimonials[currentTestimonial].classList.remove("active");

      currentTestimonial = (currentTestimonial + 1) % testimonials.length;

      testimonials[currentTestimonial].classList.add("active");
    }

    // Change testimonial every 4 seconds with smooth fade effect
    setInterval(rotateTestimonials, 4000);

    function searchPlace() {
      let query = document.getElementById("searchInput").value;
      if (!query) {
        alert("Please enter a location!");
        return;
      }
      fetch(
        `https://nominatim.openstreetmap.org/search?q=${query}&format=json`
      )
        .then((response) => response.json())
        .then((data) => {
          if (data.length === 0) {
            alert("Location not found!");
            return;
          }
          let place = data[0];
          addMarker(place.lat, place.lon, place.display_name);
          fetch(`http://localhost:5000/api/places?city=${query}`)
            .then((res) => res.json())
            .then((result) => showPlaces(result.places))
            .catch((error) => console.error("Error:", error));
        })
        .catch((error) => console.error("Error:", error));
    }

    function showPlaces(places) {
      let placesDiv = document.getElementById("places-list");
      placesDiv.innerHTML = "";
      if (places.length === 0) {
        placesDiv.innerHTML = "<p>No popular tourist attractions found.</p>";
        return;
      }
      places.forEach((place) => {
        let placeCard = document.createElement("div");
        placeCard.className = "place-card";
        placeCard.innerHTML = `
                    <img src="${place.image || "https://via.placeholder.com/200"
          }" alt="${place.name}">
                    <h4>${place.name}</h4>
                    <p>${place.description}</p>
                    <a href="${place.url}" target="_blank">More Info</a>
                `;
        placesDiv.appendChild(placeCard);
      });
    }
    function showPlaces(places) {
      let placesDiv = document.getElementById("places-list");
      placesDiv.innerHTML = "";

      if (places.length === 0) {
        placesDiv.innerHTML = "<p>No popular tourist attractions found.</p>";
        return;
      }

      places.forEach((place, index) => {
        let placeCard = document.createElement("div");
        placeCard.className = "place-card";
        placeCard.innerHTML = `
            <img src="${place.image || "https://via.placeholder.com/200"
          }" alt="${place.name}">
            <h4>${place.name}</h4>
            <p>${place.description}</p>
            <a href="${place.url}" target="_blank">More Info</a>
        `;

        placesDiv.appendChild(placeCard);

        // Delay animation for a smooth effect
        setTimeout(() => {
          placeCard.classList.add("show");
        }, index * 200); // Staggered animation for each card
      });
    }
    function toggleMenu() {
      document.querySelector(".nav-links").classList.toggle("show");
    }

    document.getElementById("search").addEventListener("click", function () {
      let div = document.getElementById("map");

      if (div.style.display === "none" || div.style.display === "") {
        div.style.display = "block"; // Show after delay
        setTimeout(() => {
          div.style.opacity = "1";
        }, 100); // Slight delay to trigger transition
      } else {
        div.style.opacity = "0"; // Fade out first
        setTimeout(() => {
          div.style.display = "none";
        }, 2000); // Hide after transition completes
      }
    });

    const blogPosts = [
      {
        title: "Exploring Hidden Gems",
        content: "Discover the top underrated travel spots around the world. Many destinations are hidden from tourists but offer amazing experiences...",
        image: "/res/hidden.avif"
      },
      {
        title: "How to Travel on a Budget",
        content: "Learn smart travel hacks to save money and still enjoy your trips. Budget-friendly travel is possible with careful planning and resourcefulness...",
        image: "/res/budget.avif"
      },
      {
        title: "Must-Try Local Cuisines",
        content: "Explore the best foods you must try when visiting different countries. Every place has a unique taste and culture to offer...",
        image: "/res/localfood.avif"
      }
    ];

    function openBlog(index) {
      const modal = document.getElementById("blogModal");
      document.getElementById("modalTitle").textContent = blogPosts[index].title;
      document.getElementById("modalImage").src = blogPosts[index].image;
      document.getElementById("modalContent").textContent = blogPosts[index].content;
      modal.style.display = "flex"; // Show modal
    }

    function closeBlog() {
      document.getElementById("blogModal").style.display = "none"; // Hide modal
    }

    // Close modal when clicking outside of content
    window.onclick = function (event) {
      const loginModal = document.getElementById("loginModal");
      const blogModal = document.getElementById("blogModal");

      if (event.target === loginModal) closeLoginModal();
      if (event.target === blogModal) closeBlog();
    };


  </script>

  <h3 id="welcomeText"></h3>

  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeLoginModal()">&times;</span>
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Username" />
      <input type="password" id="password" placeholder="Password" />
      <button onclick="login()">Login</button>
      <p>Don't have an account? <a href="#" onclick="openRegisterModal()">Register here</a></p>

    </div>
  </div>
  <!-- üîê Register Modal -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeRegisterModal()">&times;</span>
      <h2>Register</h2>
      <input type="text" id="registerName" placeholder="Name" />
      <input type="text" id="registerEmail" placeholder="Email" />
      <input type="password" id="registerPassword" placeholder="Password" />
      <button onclick="register()">Register</button>
      <p><a href="#" onclick="openLoginModal()">Login</a></p>
    </div>
  </div>

  <!-- üß≠ Register Link -->


  <script>
    // üîê Register function
    // üîê Register function
    async function register() {
      const username = document.getElementById("registerName").value;
      const email = document.getElementById("registerEmail").value;
      const password = document.getElementById("registerPassword").value;

      try {
        const response = await fetch("http://localhost:5000/api/auth/register", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ username, email, password })
        });

        const data = await response.json();

        if (response.ok) {
          alert(data.message);
          closeRegisterModal();
        } else {
          alert("Register failed: " + data.error);
        }
      } catch (error) {
        console.error("Register error:", error);
        alert("An error occurred during registration.");
      }
    }


    // üß≠ Modal toggles
    function openRegisterModal() {
      document.getElementById("registerModal").style.display = "block";
      document.getElementById("loginModal").style.display = "none";
    }

    function closeRegisterModal() {
      document.getElementById("registerModal").style.display = "none";
    }
  </script>

  <script>
    async function login() {
      const email = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      try {
        const response = await fetch("http://localhost:5000/api/auth/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (data.success) {
          localStorage.setItem("token", data.token);
          alert("Login successful!");
          closeLoginModal(); // Optionally close the modal
          // You can now call protected APIs
        } else {
          alert("Login failed: " + data.error);
        }
      } catch (error) {
        console.error("Login error:", error);
        alert("An error occurred during login.");
      }
    }
  </script>


</body>

</html>